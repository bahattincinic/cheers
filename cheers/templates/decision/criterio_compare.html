{% extends "base_site.html" %}

{% block title %} - Adım 3{% endblock title %}


{% block content %}
 <div class="container">
   <div class="row bs-wizard" style="border-bottom:0; margin-left: 1px; margin-right: 60px;">
       <div class="col-xs-3 bs-wizard-step complete">
         <div class="text-center bs-wizard-stepnum">Adım 1</div>
         <div class="progress"><div class="progress-bar"></div></div>
         <a href="#" class="bs-wizard-dot"></a>
         <div class="bs-wizard-info text-center">Kriterlerin Puanlamaları</div>
       </div>
       
       <div class="col-xs-3 bs-wizard-step complete"><!-- complete -->
         <div class="text-center bs-wizard-stepnum">Adım 2</div>
         <div class="progress"><div class="progress-bar"></div></div>
         <a href="#" class="bs-wizard-dot"></a>
         <div class="bs-wizard-info text-center">Verilerin Puanlaması ve Kısırlarla Ağırlaklandırması</div>
       </div>
       
       <div class="col-xs-3 bs-wizard-step complete">
         <div class="text-center bs-wizard-stepnum">Adım 3</div>
         <div class="progress"><div class="progress-bar"></div></div>
         <a href="#" class="bs-wizard-dot"></a>
         <div class="bs-wizard-info text-center">Kriter Kıyaslamaları</div>
       </div>
       
       <div class="col-xs-3 bs-wizard-step disabled"><!-- active -->
         <div class="text-center bs-wizard-stepnum">Adım 4</div>
         <div class="progress"><div class="progress-bar"></div></div>
         <a href="#" class="bs-wizard-dot"></a>
         <div class="bs-wizard-info text-center">Sonuç</div>
       </div>
   </div>  
  </div>
 </div>
 

 <div class="container">
  <div style="margin-left: 20px; margin-top: 30px;">
    <legend>Kriterlerin Kendi Aralarında Kıyası</legend>
     <form method="post">
        {% csrf_token %}
        <table class="table" style="margin-top: 20px;">
          <thead>
            <tr>
              <th>Kriterler</th>
              {% for criterion in criterions %}
                <th>{{ criterion.name }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for criterion in criterions %}
              <tr>
                <td>{{ criterion.name }}</td>
                {% for child in criterions %}
                  <td>
                    <input
                      type="text"
                      required="required"
                      class="form-control"
                      {% if forloop.counter == forloop.parentloop.counter or forloop.counter < forloop.parentloop.counter %}
                        disabled style="color: #2f4154;"
                      {% endif %}
                      value="{% if forloop.counter == forloop.parentloop.counter %}1.0{% endif %}"
                    />
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
            <tfoot>
              <tr style="background-color: #efefef;">
                <td>Sütun Toplamları</td>
                {% for child in criterions %}
                <td>0</td>
                {% endfor %}
              </tr>
            </tfoot>
          </table>
        </table>
     </form>

     <div style="float: right;margin-bottom: 30px;">
       <button class="btn btn-lg btn-inverse">Normalize Tablosunu Göster</button>
     </div>
  </div>
 </div>
{% endblock content %}

{% block footer %}
 <script type="text/javascript">
    $(function() {
      $('input[type=text]').on('change', function(event){
        var value = $(this).val();
        var parsedValue = value.split('/');
        var rowIndex = $(this).parent().parent().index() + 1;
        var cellIndex = $(this).parent().index();
        var input = $('table tr:eq(' + cellIndex  +  ') > td:eq(' + rowIndex + ')').find('input');

        if (parsedValue.length === 2) {
          $(this).val(parseFloat(parseInt(parsedValue[0]) / parseInt(parsedValue[1])).toFixed(2));
          $(input).val( parseFloat(parseInt(parsedValue[1]) / parseInt(parsedValue[0])).toFixed(2) );
          calculateTotal();
        } else {
         $(this).val('');
         $(input).val('');
        }
      });
    });

    function calculateTotal() {
      var total = {};
      _.forEach($('table tbody > tr > td'), function(column){
        if ($(column).find('input').length > 0) {
          var index = $(column).index();
          if (total[index]) {
            total[index] += parseFloat($(column).find('input').val()) || parseFloat(0.0);
          } else {
            total[index] = parseFloat($(column).find('input').val()) || parseFloat(0.0);
          }
        }
      });

      _.forEach($('table tfoot > tr:eq(0) > td'), function(column, index) {
        if (index !== 0) {
          $(column).text(parseFloat(total[index]).toFixed(2) || parseFloat(0.0));
        }
      });
    }
 </script> 
{% endblock footer %}